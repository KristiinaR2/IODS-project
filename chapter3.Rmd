---
title: "chapter3.Rmd"
author: "Kristiina"
date: "12 11 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(dplyr)
library(GGally)
library(ggplot2)

setwd("C:/LocalData/krraiha/Opiskelu HY/Jatko-opinnot/IODS-project/Data")

```

## 2

Read the joined student alcohol consumption data into R either from your local folder (if you completed the Data Wrangling part) or from this url: 
https://github.com/rsund/IODS-project/raw/master/data/alc.csv

(In the above linked file, the column separator is a comma and the first row includes the column names).

---

Print out the names of the variables in the data and describe the data set briefly, assuming the reader has no previous knowledge of it. There is information related to the data here. (0-1 point)

"This data approach student achievement in secondary education of two Portuguese schools. The data attributes include student grades, demographic, social and school related features) and it was collected by using school reports and questionnaires. Two datasets are provided regarding the performance in two distinct subjects: Mathematics (mat) and Portuguese language (por). 

"In [Cortez and Silva, 2008], the two datasets were modeled under binary/five-level classification and regression tasks. Important note: the target attribute G3 has a strong correlation with attributes G2 and G1. This occurs because G3 is the final year grade (issued at the 3rd period), while G1 and G2 correspond to the 1st and 2nd period grades. It is more difficult to predict G3 without G2 and G1, but such prediction is much more useful (see paper source for more details)." 

Source: [https://archive.ics.uci.edu/ml/datasets/Student+Performance#]

In the data frame 'alc' there are	370 observations of 51 variables.


```{r}
alc <- read.table("https://github.com/rsund/IODS-project/raw/master/data/alc.csv", sep = "," , header=TRUE)
str(alc)
colnames(alc)

```

## 3

The purpose of your analysis is to study the relationships between high/low alcohol consumption and some of the other variables in the data. To do this, choose 4 interesting variables in the data and for each of them, present your personal hypothesis about their relationships with alcohol consumption. (0-1 point)

I chose student's sex, the quality of their family realtionships, and parents educational backround to observe in relation to the use of alcohol. 

alc$alc_use ()
alc$high_use (logi) The variable high_use is a logical one: TRUE/FALSE. 

alc$sex (chr) student's sex (binary: 'F' - female or 'M' - male)
alc$famrel (int) quality of family relationships (numeric: from 1 - very bad to 5 - excellent)
alc$Medu (int) mother's education (numeric: 0 - none, 1 - primary education (4th grade), 2 - 5th to 9th grade, 3 - secondary education or 4 - higher education)
alc$Fedu (int)  father's education (numeric: 0 - none, 1 - primary education (4th grade), 2 - 5th to 9th grade, 3 - secondary education or 4 - higher education)

My hypotheses are: 
I. The sex male predicts high alcohol use
II. The poor quality (values 1 & 2) of family relationships predicts high alcohol use
III. Mothers low educational level (values 0-2) predicts high alcohol use
IV. Fathers low educational level (values 0-2) predicts high alcohol use

```{r}
gather(alc) %>% glimpse
gather(alc) %>% ggplot(aes(value)) + facet_wrap("key", scales = "free") + geom_bar()

summary(alc$alc_use)

```


## 4

Numerically and graphically explore the distributions of your chosen variables and their relationships with alcohol consumption (use for example cross-tabulations, bar plots and box plots). Comment on your findings and compare the results of your exploration to your previously stated hypotheses. (0-5 points)

The alcohol consumption (range 1-5) frequency is highest at the smallest numbers (where can i find explanations for these numbers??). 

The frequency in the high-use category is lower than in the low-use (high use n=111, low-use n=259). 
The sexes are almost equally distributed, (f=195, m=175). The family relations are bad only in 9,5% of the cases (n (1-2)= 36, n (3-5) = 344). The educational level of the mothers in a bit higher that the fathers. 

The frequency of high usage is higher with the male group (males: high-use n= 70, low-use n=105), than females (females: high-use n= 41, low-use n=154).

The means of the family relations and mothers’ education are higher in the low-usage group. The mean of fathers’ education is slightly higher in the high-use group. The difference is in the high-use female group: the mean of the fathers education is higher in the high-use group, as for the males in high-use group the mean of the fathers education is lower.

As for the hypotheses I set earlier, the male sex seems to be associated with a higher frequency of alcohol use (I), as does the poorer quality of family relationships (II) and mothers lower educational level (III), but the fathers educational level is not associated with the lower alcohol consumption in females (IV).



```{r}
# define a new logical column 'high_use'
#alc <- mutate(alc, high_use = alc_use > 2)
#alc <- mutate(alc, low_use = alc_use <= 2)

#Alcohol use & high_use
summary(alc$alc_use)

ggplot(data = alc, aes(x = alc_use))+ geom_bar()
ggplot(data = alc, aes(x = high_use))+ geom_bar()

alc %>% group_by(high_use) %>% summarise(count = n())
alc %>% group_by(high_use, sex) %>% summarise(count = n())
alc %>% group_by(sex) %>% summarise(count = n())
alc %>% group_by(famrel) %>% summarise(count = n())
alc %>% group_by(Medu) %>% summarise(count = n())
alc %>% group_by(Fedu) %>% summarise(count = n())


alc_agg <- alc %>%
  group_by(high_use, sex)%>%
  summarise(alc_use_mean = round(mean(alc_use), digits = 2),
            alc_use_sd = round(sd(alc_use), digits = 2),
            famrel_mean = round(mean(famrel), digits = 2),
            famrel_sd = round(sd(famrel), digits = 2),
            medu_mean = round(mean(Medu), digits = 2),
            medu_sd = round(sd(Medu), digits = 2),
            fedu_mean = round(mean(Fedu), digits = 2),
            fedu_sd = round(sd(Fedu), digits = 2),
             n=n())
alc_agg

alc_agg2 <- alc %>%
  group_by(sex)%>%
  summarise(alc_use_mean = round(mean(alc_use), digits = 2),
            alc_use_sd = round(sd(alc_use), digits = 2),
            famrel_mean = round(mean(famrel), digits = 2),
            famrel_sd = round(sd(famrel), digits = 2),
            medu_mean = round(mean(Medu), digits = 2),
            medu_sd = round(sd(Medu), digits = 2),
            fedu_mean = round(mean(Fedu), digits = 2),
            fedu_sd = round(sd(Fedu), digits = 2),
             n=n())
alc_agg2

alc_agg3 <- alc %>%
  group_by(high_use)%>%
  summarise(alc_use_mean = round(mean(alc_use), digits = 2),
            alc_use_sd = round(sd(alc_use), digits = 2),
            famrel_mean = round(mean(famrel), digits = 2),
            famrel_sd = round(sd(famrel), digits = 2),
            medu_mean = round(mean(Medu), digits = 2),
            medu_sd = round(sd(Medu), digits = 2),
            fedu_mean = round(mean(Fedu), digits = 2),
            fedu_sd = round(sd(Fedu), digits = 2),
             n=n())
alc_agg3

# 1. Sex

summary(alc$sex)
ggplot(data = alc, aes(x = high_use))+ geom_bar() + facet_wrap(~sex)

#Boxplot alcohol usage by sex 
alc %>%
  ggplot(aes(high_use, alc_use)) + 
  geom_boxplot(fill="red", alpha=0.2) + facet_wrap(~sex)

#Bar plot of 'high_use' by sex
ggplot(alc, aes(high_use)) + facet_wrap("sex") + geom_bar()



# 2. Family relationships 

summary(alc$famrel)
ggplot(data = alc, aes(x = famrel))+ geom_bar()
ggplot(data = alc, aes(x = high_use))+ geom_bar() + facet_wrap(~famrel)

alc_agg %>%
  ggplot(aes(high_use, famrel_mean, group = sex, colour = sex)) + 
  geom_line(alpha=.7) + 
  geom_point() + theme_classic()


# 3. Mothers education

summary(alc$Medu)
ggplot(data = alc, aes(x = Medu))+ geom_bar()
ggplot(data = alc, aes(x = high_use))+ geom_bar() + facet_wrap(~Medu)

alc_agg %>%
  ggplot(aes(high_use, medu_mean, group = sex, colour = sex)) + 
  geom_line(alpha=.7) + 
  geom_point() + theme_classic()

# 4. Fathers education

summary(alc$Fedu)
ggplot(data = alc, aes(x = Fedu))+ geom_bar()
ggplot(data = alc, aes(x = high_use))+ geom_bar() + facet_wrap(~Fedu)

alc_agg %>%
  ggplot(aes(high_use, fedu_mean, group = sex, colour = sex)) + 
  geom_line(alpha=.7) + 
  geom_point() + theme_classic()



```


## 5

Use logistic regression to statistically explore the relationship between your chosen variables and the binary high/low alcohol consumption variable as the target variable. 

Present and interpret a summary of the fitted model. Present and interpret the coefficients of the model as odds ratios and provide confidence intervals for them. Interpret the results and compare them to your previously stated hypothesis. 

Hint: If your model includes factor variables see for example the first answer of this stackexchange thread on how R treats and how you should interpret these variables in the model output (or use some other resource to study this). (0-5 points)


```{r}



```


## 6

Using the variables which, according to your logistic regression model, had a statistical relationship with high/low alcohol consumption, explore the predictive power of you model. 

Provide a 2x2 cross tabulation of predictions versus the actual values and optionally display a graphic visualizing both the actual values and the predictions. 

Compute the total proportion of inaccurately classified individuals (= the training error) and comment on all the results. Compare the performance of the model with performance achieved by some simple guessing strategy. (0-3 points)

```{r}



```

## 7

Bonus: Perform 10-fold cross-validation on your model. Does your model have better test set performance (smaller prediction error using 10-fold cross-validation) compared to the model introduced in DataCamp (which had about 0.26 error). Could you find such a model? (0-2 points to compensate any loss of points from the above exercises)


```{r}


```

## 8

Super-Bonus: Perform cross-validation to compare the performance of different logistic regression models (= different sets of predictors). Start with a very high number of predictors and explore the changes in the training and testing errors as you move to models with less predictors. Draw a graph displaying the trends of both training and testing errors by the number of predictors in the model. (0-4 points to compensate any loss of points from the above exercises)


```{r}


```

