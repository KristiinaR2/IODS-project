---
title: "week6"
output: html_document
---
```{r}
date()
```

```{r}

library(tidyverse)
library(dplyr)
library(ggplot2)

```

# Chapter 6: Analysis of longitudinal data

The Analysis exercise focuses on exploring your data and performing and interpreting simple straightforward methods (based on summary measures of data) and more advanced methods (called linear mixed effects models). For completing the Analysis exercises, include all the codes, your interpretations and explanations in the R Markdown file chapter6.Rmd.

Note: As you read the data sets in your chapter6.Rmd you may have to factor the categorical variables again, as R may not recognise them automatically as factors.


## 6.1 

"Implement the analyses of Chapter 8 of MABS using the RATS data. (0-7 points: 0-4 points for graphs or analysis results + 0-3 points for their interpretations)"


### The data

The RATS data is from a nutrition study conducted in three groups of rats
(Crowder and Hand, 1990). The groups were put on different diets, and
each rats body weight (grams) was recorded repeatedly over a 9-week
period. (MABS, p .174) The variable "Time" = days.

```{r}

# read the RATS data
RATS <- read.table("https://raw.githubusercontent.com/KimmoVehkalahti/MABS/master/Examples/data/rats.txt", header = TRUE, sep = '\t')

# Factor variables ID and Group
RATS$ID <- factor(RATS$ID)
RATS$Group <- factor(RATS$Group)

# Glimpse the data
glimpse(RATS)

# Convert data to long form
RATSL <- RATS %>%
  gather(key = WD, value = Weight, -ID, -Group) %>%
  mutate(Time = as.integer(substr(WD,3,4))) 

# Glimpse the data
glimpse(RATSL)


```

### RATS (long) plots

```{r}

# The dimensions of the data
dim(RATSL)

# Plot of the the RATSL data
ggplot(RATSL, aes(x = Time, y = Weight, group = ID)) +
  geom_line(aes(linetype = Group)) +
  scale_x_continuous(name = "Time (days)", breaks = seq(0, 60, 10)) +
  scale_y_continuous(name = "Weight (grams)") +
  theme(legend.position = "top")

# Standardising the variable RATSL
colnames(RATSL)
View(RATSL)

RATSL <- RATSL %>%
  group_by(ID) %>%
  mutate(std_weight = (Weight - mean(Weight))/sd(Weight)) %>%
  ungroup()

# Glimpse the data
glimpse(RATSL)

# The standardized RATSL weight plot by group, time and ID
ggplot(RATSL, aes(x = Time, y = std_weight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=11)) +
  facet_grid(. ~ Group, labeller = label_both) +
  scale_y_continuous(name = "standardized weight")

# The standardized RATSL weight plot by groups and time
ggplot(RATSL, aes(x = Time, y = std_weight, group = ID)) +
  geom_line(aes(linetype = Group)) +
  scale_x_continuous(name = "Time (days)", breaks = seq(0, 60, 10)) +
  scale_y_continuous(name = "Weight (grams)") +
  theme(legend.position = "top")


```

###  Analysis 

Creating, and plotting the summary data.

```{r}

# Number of measurement days, baseline (day 1) included
n <- RATSL$Time %>% unique() %>% length()
n # =11

# Number of weeks, baseline (week 0) included
#n <- BPRSL$week %>% unique() %>% length()

# Summary data with mean and standard error of weight grouped by Group and Time 
RATSL <- RATSL %>%
  group_by(Group, Time) %>%
  summarise(mean = mean(Weight), se = sd(Weight)/sqrt(n) ) %>%
  ungroup()

# Glimpse the data
glimpse(RATSL)
View(RATSL)

# Plot the mean profiles
ggplot(RATSL, aes(x = Time, y = mean, linetype = Group, shape = Group)) +
  geom_line() +
  scale_linetype_manual(values = c(1,2,3)) +
  geom_point(size=3) +
  scale_shape_manual(values = c(1,2,3)) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.9,0.5)) +
  scale_y_continuous(name = "mean(Weight) +/- se(Weight)")

# A boxplot of the mean versus group
ggplot(RATSL, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(weight), days")


```
### The analysis

T-test and ANOVA

```{r}

```


## 6.2

"Implement the analyses of Chapter 9 of MABS using the BPRS data. (0-8 points: 0-4 points for graphs or analysis results + 0-4 points for their interpretations)"

### The data

```{r}

# Read the BPRS data
BPRS <- read.table("https://raw.githubusercontent.com/KimmoVehkalahti/MABS/master/Examples/data/BPRS.txt", sep  =" ", header = T)

# Look at the (column) names and structure of BPRS
names(BPRS)
str(BPRS)

BPRS$treatment <- factor(BPRS$treatment)
BPRS$subject <- factor(BPRS$subject)

# Convert to long form
BPRSL <-  BPRS %>% gather(key = weeks, value = bprs, -treatment, -subject)
glimpse(BPRSL)

# Extract the week number
BPRSL <-  BPRSL %>% mutate(week = as.integer(substr(weeks,5,5)))

# Take a glimpse at the BPRSL data
glimpse(BPRSL)

```


### Plots

```{r}
ggplot(BPRSL, aes(x = week, y = bprs, linetype = subject)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ treatment, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(BPRSL$bprs), max(BPRSL$bprs)))


```


## 6.3



```{r}

```


